//https://github.com/ethereum/wiki/wiki/JavaScript-API

let Web3   = require('web3');

let web3 = new Web3();
web3.setProvider(new web3.providers.HttpProvider('HTTP://10.211.55.2:7545'));

if (!web3.isConnected()) {
    console.log("not connected");
    process.exit();
}
else 
{
    console.log("connected");
}


//ㄹㅇㄹㅁㄴㄹㅁㄴㅇㄹㅁㄴㅇㄹfdlfjasldjflasd안녕하세요.



//new web3.eth.Contract(abi, contractAddress);

var abi = '[{"constant":true,"inputs":[],"name":"say","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_greeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greeting","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]';
var addr = '0xd54b47f8e6a1b97f3a84f63c867286272b273b7c';

// var h = web3.eth.contract(abi, addr);
// console.info(h);

var MyContract = web3.eth.contract(JSON.parse(abi));
var myContractInstance = MyContract.at(addr);

// console.info(myContractInstance);
// console.info(myContractInstance.say());
// console.info(myContractInstance.greeting());

// myContractInstance.say((e, r)=> {

//     console.info(r + "");
//     //console.info(e);
// });


myContractInstance.setGreeting("방가방가123", {
     from: web3.eth.coinbase, 
     gas: '100000'
   }, function (e, result){
    console.log(e, result);

    myContractInstance.say((e, r)=> {

        console.info(r + "");
        //console.info(e);
    }); 
});


// 만약 setGreeting 를 setTransation 를 이용하면 gas의 비용이 든다.



// var number = web3.eth.getCompilers();
// console.log(number); 


// var result = myContractInstance.myConstantMethod('myParam');
// console.log(result) // '0x25434534534'

// var hash = web3.sha3("Some string to be hashed");
// console.log(hash); 

// var str = web3.toAscii("0x657468657265756d000000000000000000000000000000000000000000000000");
// console.log(str); // "ethereum"

// var peerCount = web3.net.peerCount;
// console.log(peerCount); // 4


// web3.eth.getAccounts((error, result) => { 
//     console.info(result);
//  })

// console.log(web3.version.node);

// web3.version.getNode(function(error, result){ 
//     console.info(result);
// });


//console.log(h.say());


//console.log(helloworldContract.eth.getBlockUncleCount{});

//console.log(helloworldContract);

// var _greeting = "Hi, James";
// var helloworldContract = web3.eth.contract();
// var helloworld = helloworldContract.new(
//    _greeting,
//    {
//      from: web3.eth.accounts[0], 
//      data: '0x6060604052341561000f57600080fd5b604051610516380380610516833981016040528080518201919050508060009080519060200190610041929190610048565b50506100ed565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061008957805160ff19168380011785556100b7565b828001600101855582156100b7579182015b828111156100b657825182559160200191906001019061009b565b5b5090506100c491906100c8565b5090565b6100ea91905b808211156100e65760008160009055506001016100ce565b5090565b90565b61041a806100fc6000396000f300606060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063954ab4b21461005c578063a4136862146100ea578063ef690cc014610147575b600080fd5b341561006757600080fd5b61006f6101d5565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100af578082015181840152602081019050610094565b50505050905090810190601f1680156100dc5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156100f557600080fd5b610145600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061027d565b005b341561015257600080fd5b61015a610297565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561019a57808201518184015260208101905061017f565b50505050905090810190601f1680156101c75780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101dd610335565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102735780601f1061024857610100808354040283529160200191610273565b820191906000526020600020905b81548152906001019060200180831161025657829003601f168201915b5050505050905090565b8060009080519060200190610293929190610349565b5050565b60008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561032d5780601f106103025761010080835404028352916020019161032d565b820191906000526020600020905b81548152906001019060200180831161031057829003601f168201915b505050505081565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061038a57805160ff19168380011785556103b8565b828001600101855582156103b8579182015b828111156103b757825182559160200191906001019061039c565b5b5090506103c591906103c9565b5090565b6103eb91905b808211156103e75760008160009055506001016103cf565b5090565b905600a165627a7a723058205d3589570fea65e46d102df2b68703636337cf4b076eb49c6507664601cc1f500029', 
//      gas: '4700000'
//    }, function (e, contract){
//     console.log(e, contract);
//     if (typeof contract.address !== 'undefined') {
//          console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
//     }
//  })





















//console.log(web3.eth.defaultAccount);



// var coursetroContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_fName","type":"string"},{"name":"_age","type":"uint256"}],"name":"setInstructor","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getInstructor","outputs":[{"name":"","type":"string"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]);
// var coursetro = coursetroContract.new(
//    {
//      from: web3.eth.accounts[0], 
//      data: '0x6060604052341561000f57600080fd5b6103058061001e6000396000f30060606040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806322faf03a146100515780633c1b81a5146100b7575b600080fd5b341561005c57600080fd5b6100b5600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001909190505061014c565b005b34156100c257600080fd5b6100ca61016e565b6040518080602001838152602001828103825284818151815260200191508051906020019080838360005b838110156101105780820151818401526020810190506100f5565b50505050905090810190601f16801561013d5780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b8160009080519060200190610162929190610220565b50806001819055505050565b6101766102a0565b600080600154818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102115780601f106101e657610100808354040283529160200191610211565b820191906000526020600020905b8154815290600101906020018083116101f457829003601f168201915b50505050509150915091509091565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061026157805160ff191683800117855561028f565b8280016001018555821561028f579182015b8281111561028e578251825591602001919060010190610273565b5b50905061029c91906102b4565b5090565b602060405190810160405280600081525090565b6102d691905b808211156102d25760008160009055506001016102ba565b5090565b905600a165627a7a72305820e66737dd03d43705325019517a01de6f4a5784aaba76ef7989b56fa5728ff6960029', 
//      gas: '4700000'
//    }, function (e, contract){
//     console.log(e, contract);
//     if (typeof contract.address !== 'undefined') {
//          console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
//     }
//  })


// var _greeting = "hi, James";
// var helloworldContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"say","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_greeting","type":"string"}],"name":"setGreeting","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"greeting","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_greeting","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);

// console.info(helloworldContract);

// var helloworld = helloworldContract.at(
//    _greeting,
//    {
//      from: web3.eth.accounts[0], 
//      data: '0x6060604052341561000f57600080fd5b604051610516380380610516833981016040528080518201919050508060009080519060200190610041929190610048565b50506100ed565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061008957805160ff19168380011785556100b7565b828001600101855582156100b7579182015b828111156100b657825182559160200191906001019061009b565b5b5090506100c491906100c8565b5090565b6100ea91905b808211156100e65760008160009055506001016100ce565b5090565b90565b61041a806100fc6000396000f300606060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063954ab4b21461005c578063a4136862146100ea578063ef690cc014610147575b600080fd5b341561006757600080fd5b61006f6101d5565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100af578082015181840152602081019050610094565b50505050905090810190601f1680156100dc5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156100f557600080fd5b610145600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061027d565b005b341561015257600080fd5b61015a610297565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561019a57808201518184015260208101905061017f565b50505050905090810190601f1680156101c75780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101dd610335565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102735780601f1061024857610100808354040283529160200191610273565b820191906000526020600020905b81548152906001019060200180831161025657829003601f168201915b5050505050905090565b8060009080519060200190610293929190610349565b5050565b60008054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561032d5780601f106103025761010080835404028352916020019161032d565b820191906000526020600020905b81548152906001019060200180831161031057829003601f168201915b505050505081565b602060405190810160405280600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061038a57805160ff19168380011785556103b8565b828001600101855582156103b8579182015b828111156103b757825182559160200191906001019061039c565b5b5090506103c591906103c9565b5090565b6103eb91905b808211156103e75760008160009055506001016103cf565b5090565b905600a165627a7a723058205d3589570fea65e46d102df2b68703636337cf4b076eb49c6507664601cc1f500029', 
//      gas: '4700000'
//    }, function (e, contract){
//     //console.log(contract);

//     //console.log(contract.name);
    
//     //console.log(e, contract);
//     if (typeof contract.address !== 'undefined') {
//          console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
//     }
//  })

